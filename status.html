<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Status Report</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Website Status</h1>
    </header>

    <section id="overall-status">
        <h2>Overall Status: <span id="overall-status-indicator" class="status-indicator operational">Operational</span></h2>
        <p>All systems are currently operational.</p>
    </section>

    <section id="key-metrics">
        <h2>Key Metrics</h2>
        <ul>
            <li>Uptime: <span id="uptime">99.9%</span></li>
            <li>Average Response Time: 200ms</li>
            <li>Traffic: Normal</li>
        </ul>
    </section>

    <section id="issues">
        <h2>Known Issues</h2>
        <p>View details on the <a href="issues.html">Issues Page</a>.</p>
    </section>

    <section id="admin-controls">
        <h2>Update Status</h2>
        <form id="status-update-form">
            <label for="overall_status">Overall Status:</label>
            <select id="overall_status" name="overall_status">
                <option value="Operational">Operational</option>
                <option value="Degraded">Degraded</option>
                <option value="Major Outage">Major Outage</option>
            </select><br><br>

            <label for="uptime">Uptime:</label>
            <input type="text" id="uptime" name="uptime"><br><br>

            <button type="submit">Update Status</button>
        </form>
    </section>

    <footer>
        <p>&copy; 2023 [Your Company]</p>
    </footer>

    <script>
        const eventSource = new EventSource('/status_stream');

        eventSource.onmessage = function(event) {
            const statusData = JSON.parse(event.data);
            document.getElementById('overall-status-indicator').textContent = statusData.overall_status;
            document.getElementById('uptime').textContent = statusData.uptime;

            //Update indicator color based on status

            const indicator = document.getElementById('overall-status-indicator');

            if (statusData.overall_status == "Operational") {
                indicator.className = "status-indicator operational";
            } else if (statusData.overall_status == "Degraded") {
                indicator.className = "status-indicator degraded";
            } else {
                indicator.className = "status-indicator major-outage";
            }

            //You would update other parts of the page here based on statusData
        };

        eventSource.onerror = function(error) {
            console.error("EventSource failed:", error);
        };

         document.getElementById('status-update-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const overallStatus = document.getElementById('overall_status').value;
            const uptime = document.getElementById('uptime').value;

            // Send data to your API endpoint using fetch or XMLHttpRequest
            fetch('/update_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ overall_status: overallStatus, uptime: uptime })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Status updated:', data);
                // Optionally update the page directly, or rely on SSE update
            })
            .catch(error => console.error('Error updating status:', error));
        });
    </script>
</body>
</html>